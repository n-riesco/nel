<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Home</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Home</h1>

    



    


    <h3> </h3>










    




    <section>
        <article><h1>Node.js Evaluation Loop (NEL)</h1>
<p><code>NEL</code> is an <a href="https://www.npmjs.com/">npm module</a> for running
<a href="https://nodejs.org/">Node.js</a> REPL sessions.</p>
<p><code>NEL</code> is a spin-off library from
<a href="https://n-riesco.github.io/ijavascript">IJavascript</a>. This fact explains some
of the design decisions in <code>NEL</code>, such as returning results in MIME format, and
the functionality provided for completion and inspection of Javascript
expressions.  See the section on usage for more details.</p>
<p><code>NEL</code> is used by the following Jupyter kernels:</p>
<ul>
<li><a href="https://n-riesco.github.io/ijavascript">IJavascript</a></li>
<li><a href="https://www.npmjs.com/package/itypescript">ITypescript</a></li>
<li><a href="https://github.com/n-riesco/jp-babel">jp-babel</a></li>
<li><a href="https://github.com/n-riesco/jp-coffeescript">jp-coffeescript</a></li>
</ul>
<h2>Main Features</h2>
<ul>
<li>Run Javascript code within a <code>Node.js</code> session. The result can be formatted
as:
<ul>
<li><a href="http://n-riesco.github.io/ijavascript/doc/hello.ipynb.html">plain text</a></li>
<li><a href="http://n-riesco.github.io/ijavascript/doc/custom.ipynb.html">other MIME
formats</a>
(<code>HTML</code>, <code>SVG</code>, <code>PNG</code>...)</li>
</ul>
</li>
<li>Run Javascript code
<a href="http://n-riesco.github.io/ijavascript/doc/async.ipynb.html">asynchronously</a>.</li>
<li>Generate a list of <a href="http://n-riesco.github.io/ijavascript/doc/complete.md.html">completion
options</a> for an
incomplete piece of Javascript code.</li>
<li><a href="http://n-riesco.github.io/ijavascript/doc/inspect.md.html">Inspect a Javascript
expression</a> and
return information such as type or even documentation (currently, only for
Javascript builtins).</li>
</ul>
<h2>Announcements</h2>
<ul>
<li><code>NEL v1.3.0</code>: API enhancement (added option awaitExecution)</li>
<li><code>NEL v1.2.0</code>: API enhancement (Session#transpile may return a Promise)</li>
<li><code>NEL v1.1.0</code>: API enhancement (added $$.clear({wait}))</li>
<li><code>NEL v1.0.0</code>: Stable API</li>
<li><code>NEL v0.5.6</code>: API enhancement (added $$.input() and onRequest callback)</li>
<li><code>NEL v0.5.5</code>: Accept Promises as output</li>
<li><code>NEL v0.5.4</code>: API enhancement (added $$.display() and onDisplay callback)</li>
<li><code>NEL v0.5</code>: API enhancement (added transpile option)</li>
<li><code>NEL v0.4</code>: API enhancement (added onStdout and onStderr callbacks)</li>
<li><code>NEL v0.3</code>: New API (simplify API by hiding type module:nel~Task)</li>
<li><code>NEL v0.2</code>: API change (removed Session#executionCount)</li>
<li><code>NEL v0.1.1</code>: API enhancement (experimental <code>$$mimer$$</code> and <code>$$defaultMimer$$</code>)</li>
<li><code>NEL v0.1</code>: Output change (changed function output)</li>
<li><code>NEL v0.0</code>: Initial release</li>
</ul>
<h2>Install</h2>
<pre class="prettyprint source lang-sh"><code>npm install nel
</code></pre>
<h2>Usage</h2>
<p>The documentation generated by JSDoc can be found
<a href="http://n-riesco.github.io/nel/">here</a>.</p>
<h3>Hello, World!</h3>
<pre class="prettyprint source lang-js"><code>// Load `nel` module
var nel = require(&quot;nel&quot;);

// Setup a new Javascript session
var session = new nel.Session();

// Example of an execution request
// Output:
// { mime: { 'text/plain': '\'Hello, World!\'' } }
var code = &quot;['Hello', 'World!'].join(', ');&quot;;
session.execute(code, {
    onSuccess: console.log,
    onError: console.error,
});
</code></pre>
<h3>Exceptions</h3>
<pre class="prettyprint source lang-js"><code>// Example of throwing an exception
// Output:
// { error:
//  { ename: 'Error',
//    evalue: 'Hello, World!',
//    traceback:
//     [ 'Error: Hello, World!',
//       '    at evalmachine.&lt;anonymous>:1:7',
//       '    at run ([eval]:182:19)',
//       '    at onMessage ([eval]:63:41)',
//       '    at process.EventEmitter.emit (events.js:98:17)',
//       '    at handleMessage (child_process.js:318:10)',
//       '    at Pipe.channel.onread (child_process.js:345:11)' ] } }
code = &quot;throw new Error('Hello, World!');&quot;;
session.execute(code, {
    onSuccess: console.log,
    onError: console.error,
});
</code></pre>
<h3><code>stdout</code> and <code>stderr</code></h3>
<pre class="prettyprint source lang-js"><code>// Example of use of console.log()
// Output:
// Hello, World!
//
// { mime: { 'text/plain': 'undefined' } }
code = &quot;console.log('Hello, World!');&quot;;
session.execute(code, {
    onSuccess: console.log,
    onError: console.error,
    onStdout: console.log,
    onStderr: console.error,
});
</code></pre>
<h3><code>onDisplay</code> callback</h3>
<p>The <a href="http://jupyter-client.readthedocs.io/en/latest/messaging.html#display-data">Jupyter messaging protocol</a>
introduces the concept of display. A display is very much like an execution
result. It is associated with an execution request and in protocol version 5.1
and above it can be assigned an ID for subsequent updates. Here's an example of
the support provided by <code>NEL</code>:</p>
<pre class="prettyprint source lang-js"><code>// Example using onDisplay callback
// Output:
// { mime: { 'text/plain': 'Hello, World!' } }
code = &quot;$$.display().text('Hello, World!');&quot;;
session.execute(code, {
    onDisplay: console.log,
});

// Example using a display ID
// Output:
// { display_id: 'test', mime: { 'text/plain': 'Hello, World!' } }
code = &quot;$$.display('test').text('Hello, World!');&quot;;
session.execute(code, {
    onDisplay: console.log,
});
</code></pre>
<h3><code>onRequest</code> callback and <code>$$.input(options, callback)</code></h3>
<p>The <a href="http://jupyter-client.readthedocs.io/en/latest/messaging.html#messages-on-the-stdin-router-dealer-channel">Jupyter messaging protocol</a>
defines an stdin socket, so that a kernel can request an input from the user.
<code>NEL</code> defines <code>$$.input(options, callback)</code> to create such a request.</p>
<p>Here are two examples (first one passing a callback to <code>$$.input</code>; second one
using a <code>Promise</code> returned by <code>$$.input()</code>):</p>
<pre class="prettyprint source lang-js"><code>// Example passing a callback to $$.input()
// Output:
// { mime: { 'text/plain': '\'opensesame\'' } }
code = &quot;$$.input({prompt:'?', password: true}, function(error, reply) {$$.done(reply)});&quot;;

session.execute(code, {
    onRequest: function(request, onReply) {
        assert(request.input.prompt === &quot;?&quot;);
        assert(request.input.password === true);

        onReply({input: &quot;opensesame&quot;});
    },
    onSuccess: console.log,
});

// Example using the Promise returned by $$.input()
// Output:
// { mime: { 'text/plain': '\'opensesame\'' } }
code = &quot;(function($$) {$$.input({prompt:'?', password: true}).then($$.done);})($$);&quot;;

session.execute(code, {
    onRequest: function(request, onReply) {
        assert(request.input.prompt === &quot;?&quot;);
        assert(request.input.password === true);

        onReply({input: &quot;opensesame&quot;});
    },
    onSuccess: console.log,
});
</code></pre>
<h3><code>onRequest</code> callback and <code>$$.clear(options)</code></h3>
<p>The <a href="http://jupyter-client.readthedocs.io/en/latest/messaging.html#clear_output">Jupyter messaging protocol</a>
defines the message <code>clear_output</code> for kernels to request the output of a cell
to be cleared. <code>NEL</code> provides <code>$$.clear(options)</code> to implement such a request.</p>
<p>Here's an example showing the use:</p>
<pre class="prettyprint source lang-js"><code>// Example using $$.clear(options)
// Output:
// { clear: { wait: true } }
code = &quot;$$.clear({wait: true});&quot;;

session.execute(code, {
    onRequest: console.log
});
</code></pre>
<h3>MIME output</h3>
<p>A session may return results in MIME formats other than 'text/plain'.</p>
<pre class="prettyprint source lang-js"><code>// HTML example
// Output:
// { mime: { 'text/html': '&lt;div style=\'background-color:olive;width:50px;height:50px\'>&lt;/div>' } }
code = &quot;$$html$$ = \&quot;&lt;div style='background-color:olive;width:50px;height:50px'>&lt;/div>\&quot;;&quot;;
session.execute(code, {
    onSuccess: console.log,
    onError: console.error,
});

// SVG example
// Output:
// { mime: { 'image/svg+xml': '&lt;svg>&lt;rect width=80 height=80 style=\'fill: orange;\'/>&lt;/svg>' } }
code = &quot;$$svg$$ = \&quot;&lt;svg>&lt;rect width=80 height=80 style='fill: orange;'/>&lt;/svg>\&quot;;&quot;;
session.execute(code, {
    onSuccess: console.log,
    onError: console.error,
});

// PNG example
code = &quot;$$png$$ = require('fs').readFileSync('image.png').toString('base64');&quot;;
session.execute(code, {
    onSuccess: console.log,
    onError: console.error,
});

// JPEG example
code = &quot;$$jpeg$$ = require('fs').readFileSync('image.jpg').toString('base64');&quot;;
session.execute(code, {
    onSuccess: console.log,
    onError: console.error,
});

// MIME example
code = &quot;$$mime$$ = {\&quot;text/html\&quot;: \&quot;&lt;div style='background-color:olive;width:50px;height:50px'>&lt;/div>\&quot;};&quot;;
session.execute(code, {
    onSuccess: console.log,
    onError: console.error,
});
</code></pre>
<h3>Promises are accepted as output</h3>
<p>When the result of an execution request is a <code>Promise</code>, <code>NEL</code> enables
asynchronous execution automatically and waits for the <code>Promise</code> to resolve:</p>
<pre class="prettyprint source lang-js"><code>// Example returning a Promise
// Output:
// { mime: { 'text/plain': '\'Hello, World!\'' } }
code = &quot;Promise.resolve('Hello, World!');&quot;;

session.execute(code, {
    onSuccess: console.log,
});
</code></pre>
<h3>Generate a completion list</h3>
<p><code>NEL</code> can parse simple Javascript variable expressions and generate a list of
completion options:</p>
<pre class="prettyprint source lang-js"><code>session.complete(
    &quot;set&quot;,     // code
    3,         // cursorPos
    {
        onSuccess: console.log,
        onError: console.error,
    }
);

// Output:
// { completion:
//    { list: [ 'setImmediate', 'setInterval', 'setTimeout' ],
//      code: 'set',
//      cursorPos: 3,
//      matchedText: 'set',
//      cursorStart: 0,
//      cursorEnd: 3 } }
</code></pre>
<p>Note that the cursor position can be located anywhere within the Javascript
code:</p>
<pre class="prettyprint source lang-js"><code>session.complete(
    &quot;set&quot;,     // code
    2,         // cursorPos
    {
        onSuccess: console.log,
        onError: console.error,
    }
);

// Output:
// { completion:
//    { list: [ 'setImmediate', 'setInterval', 'setTimeout' ],
//      code: 'set',
//      cursorPos: 2,
//      matchedText: 'se',
//      cursorStart: 0,
//      cursorEnd: 3 } }
</code></pre>
<h3>Inspect an expression</h3>
<p><code>NEL</code> can parse simple Javascript variable expressions and inspect their value:</p>
<pre class="prettyprint source lang-js"><code>code = &quot;var a = [1, 2, 3];&quot;;
session.execute(code, null, onError);
session.inspect(
    code,      // code
    5,         // cursorPos
    {
        onSuccess: console.log,
        onError: console.error,
    }
);

// Output:
// { inspection:
//    { string: '[ 1, 2, 3 ]',
//      type: 'Array',
//      constructorList: [ 'Array', 'Object' ],
//      length: 3,
//      code: 'var a = [1, 2, 3];',
//      cursorPos: 5,
//      matchedText: 'a' } }
</code></pre>
<p><code>NEL</code> can also provide relevant documentation (currently only available for
Javascript builtins):</p>
<pre class="prettyprint source lang-js"><code>session.inspect(
    &quot;parseInt&quot;, // code
    8,          // cursorPos
    {
        onSuccess: console.log,
        onError: console.error,
    }
);

// Output:
// { inspection:
//    { string: '[Function: parseInt]',
//      type: 'Object',
//      constructorList: [ 'Function', 'Object' ],
//      length: 2,
//      code: 'parseInt',
//      cursorPos: 8,
//      matchedText: 'parseInt' },
//   doc:
//    { description: 'The parseInt() function parses a string argument and returns an integer of the specified radix (the base in mathematical numeral systems).',
//      url: 'https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/parseInt',
//      usage: 'parseInt(string, radix);' } }
</code></pre>
<h3>Callbacks <code>beforeRun</code> and <code>afterRun</code></h3>
<pre class="prettyprint source lang-js"><code>var beforeRun = function() { console.log(&quot;This callback runs first&quot;); }
code = &quot;'I run next'&quot;;
var afterRun = function() { console.log(&quot;This callback runs last&quot;); }
session.execute(code, {
    onSuccess: console.log,
    onError: console.error,
    beforeRun: beforeRun,
    afterRun: afterRun,
});

// Output:
// This callback runs first
// { mime: { 'text/plain': '\'I run next\'' } }
// This callback runs last
</code></pre>
<h2>Contributions</h2>
<p>First of all, thank you for taking the time to contribute. Please, read
<a href="https://github.com/n-riesco/nel/blob/master/CONTRIBUTING.md">CONTRIBUTING.md</a>
and use the <a href="https://github.com/n-riesco/nel/issues">issue tracker</a> for
any contributions: support requests, bug reports, enhancement requests, pull
requests, ...</p>
<h2>TODO</h2>
<ul>
<li>Add tests for customising output</li>
<li>Add <code>Node.js</code> documentation</li>
</ul></article>
    </section>






</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-log.html">log</a></li><li><a href="module-nel.html">nel</a></li></ul><h3>Classes</h3><ul><li><a href="module-nel-Session.html">Session</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.10</a> on Wed Feb 23 2022 19:26:25 GMT+0000 (Greenwich Mean Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>